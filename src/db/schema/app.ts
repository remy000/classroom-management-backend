import { relations } from "drizzle-orm";
import { integer, pgTable, timestamp, varchar } from "drizzle-orm/pg-core";



const timestamps={
    createdAt: timestamp('created_at').defaultNow().notNull(),
    updatedAt: timestamp('updated_at').defaultNow().$onUpdate(()=> new Date()),
}
export const departments=pgTable('departments',{
    id: integer('id').primaryKey().generatedAlwaysAsIdentity(),
    code: varchar('code',{length:100}).notNull().unique(),
    name: varchar('name',{length:255}).notNull(),
    description:varchar('description',{length:500}),
    ...timestamps


})

export const subjects=pgTable('subjects',{
    id: integer('id').primaryKey().generatedAlwaysAsIdentity(),
    departmentId:integer('department_id').notNull().references(()=>departments.id, {onDelete:'restrict',onUpdate:'cascade'}),
    name: varchar('name',{length:255}).notNull(),
    code: varchar('code',{length:100}).notNull().unique(),
    description:varchar('description',{length:500}),
    ...timestamps


})

const departmentRelations=relations(departments,({many})=>({
    subjects: many(subjects)
}))

const subjectRelations=relations(subjects,({one, many})=>({
    department: one(departments,{
        fields:[subjects.departmentId],
        references:[departments.id]
    })
}))

export type Department =typeof departments.$inferSelect;
export type newDepartment =typeof departments.$inferInsert;

export type Subject =typeof subjects.$inferSelect;
export type newSubject =typeof subjects.$inferInsert;